/* REPLACE SUMMERNOTE WITH CKEDITOR BY CL!CKER
 * Author: Cl!cker
 * Website: https://opencart.click
 *
 * Commercial OpenCart CKEditor integration extension
*/

function c_ckeSetConfig(n){if(void 0!==window.ck_clicker&&"4"==window.ck_clicker){setTimeout(function(){var e,t,n="ck_css";document.getElementById(n)||(e=document.getElementsByTagName("head")[0],(t=document.createElement("link")).id=n,t.rel="stylesheet",t.type="text/css",t.href=CKEDITOR.basePath+"clicker/ck_clicker.css",t.media="all",e.appendChild(t))},10),n.contentsLangDirection=$("html").attr("dir");var e,t="";"function"!=typeof getURLVar||(e=(e=getURLVar("token"))?"&token="+e:"&user_token="+getURLVar("user_token"))&&(t=e),n.filebrowserBrowseUrl="index.php?route=common/filemanager&iframe=1"+t;var i=["&plusmn;","&Omega;"];n.contentsCss?n.contentsCss&&"array"!=typeof n.contentsCss&&(n.contentsCss=[n.contentsCss]):n.contentsCss=[],$('html link[rel="stylesheet"][href*="bootstrap"]').each(function(e,t){-1===String($(this).attr("href")).indexOf("/bootstrap.css")&&-1===String($(this).attr("href")).indexOf("/bootstrap.min.css")&&-1===String($(this).attr("href")).indexOf("/opencart.css")||n.contentsCss.push($(this).attr("href"))});for(var o=0;o<i.length;o++)n.specialChars.includes(i[o])||n.specialChars.push(i[o]);if(CKEDITOR.dtd.$removeEmpty.span=!1,CKEDITOR.dtd.$removeEmpty.i=!1,"object"==typeof cke_settings&&cke_settings){for(key in cke_settings)if("true"==cke_settings[key])n[key]=!0;else if("false"==cke_settings[key])n[key]=!1;else if("font_names"==key)n[key]=String(JSON.parse(JSON.stringify(cke_settings[key]))).replace(/(\r\n|\n|\r)/gm,"");else if("customCss"==key){if(String(n[key]).trim()&&(n[key]=String(JSON.parse(JSON.stringify(cke_settings[key]))).replace(/(\r\n|\n|\r)/gm,"||"),n[key]=String(n[key]).split("||"),n[key]))for(idx in n[key])n[key][idx]=String(n[key][idx]).trim(),n[key][idx]&&n.contentsCss.push(n[key][idx])}else"customConfigJson"==key||(n[key]=JSON.parse(JSON.stringify(cke_settings[key])));if("true"==cke_settings.autoGrow_status?(n.resize_enabled=!1,n.extraPlugins+=",autogrow",n.autoGrow_bottomSpace=50,n.autoGrow_onStartup=!0):(n.removePlugins+=",autogrow",n.autoGrow_minHeight=n.height,n.autoGrow_maxHeight=n.height),n.externalPlugins)for(key in n.externalPlugins)CKEDITOR.plugins.addExternal(n.externalPlugins[key],"clicker/plugins/"+n.externalPlugins[key]+"/"),n.extraPlugins+=","+n.externalPlugins[key];if(cke_settings.customConfigJson){var a=JSON.parse(JSON.stringify(cke_settings.customConfigJson));if("object"==typeof a&&a)for(key in a)n[key]=JSON.parse(JSON.stringify(a[key]))}}return n.contentsCss.push(CKEDITOR.basePath+"clicker/contents.css"),n}}function replace_summernote(e,i){if("undefined"!=typeof CKEDITOR)return e.each(function(e,t){var n;for(void 0!==$(t).attr("id")&&$(t).attr("id")?n=$(t).attr("id"):(n=String(10*Math.random()).replace(".",""),$(t).attr("id",n));1<$('[id="'+n+'"]').length;)n=String(10*Math.random()).replace(".","");$(t).attr("id",n),i.height&&i.height,CKEDITOR.instances[$(t).attr("id")]||CKEDITOR.replace($(t).attr("id"),{}),$(t).after('<div class="note-editor" style="display:none;" options-height="'+i.height+'"></div>')}),e;console.error("CKEDITOR is not found!")}window.c_cke=function(e){if(this.debug=!1,this.event_editor={},this.filename="",this.url_parts=String(document.location).split("index.php"),this.instanceLoaded_executed=!1,e)for(var t in e)this[t]=e[t];this.construct()},window.ck_clicker="4",c_cke.prototype.construct=function(){"undefined"!=typeof CKEDITOR?(CKEDITOR.on("instanceReady",function(e){e&&e.editor&&e.editor.config&&e.editor.config.forcePastePopup&&e.editor.on("beforeCommandExec",function(e){"paste"==e.data.name?e.editor._.forcePasteDialog=!0:"pastetext"==e.data.name&&"keystrokeHandler"==e.data.commandData.from&&e.cancel()})}),this.clicker="4",this.instanceLoaded(),window.setTimeout(function(){var e,t;$(".cke_inner:first").length&&(e="cke_7jrdd8REmNafYacT4UyLsYpS0h6LpkEm_"+window.location.hostname,e="_"+String(e).split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0),(window.localStorage.getItem(e)?parseFloat(window.localStorage.getItem(e)):0)<(t=parseFloat(Date.now()/1e3))&&(window.localStorage.removeItem(e),window.localStorage.setItem(e,parseInt(t+86400)),cl_cke.checkUpdates()))},parseInt("60000"))):console.error("CKEDITOR not found! Aborting...")},c_cke.prototype.instanceLoaded=function(e){this.instanceLoaded_executed||(this.instanceLoaded_executed=!0,_cl_cke=this,CKEDITOR.on("dialogDefinition",function(e){var t=e.data?e.data.name:"";if("image"==t||"link"==t||"flash"==t||"video"==t||"html5video"==t||"html5audio"==t){_cl_cke.event_editor=e.editor;for(var n=e.data.definition,i=["browseposter","browse"],o=0;o<n.contents.length;o++)for(var a=0;a<i.length;a++){var s=n.contents[o].get(i[a]);s&&null!==s&&(s.hidden=!1,s.onClick=function(e,t){_cl_cke.event_editor._.filebrowserSe=this,$.ajax({url:"index.php?route=common/filemanager&input="+_cl_cke.event_editor.name+"&CKEditorFuncNum=0&editor=ckeditor&token="+getURLVar("token")+"&user_token="+getURLVar("user_token"),dataType:"html",beforeSend:function(){_cl_cke.filename="",$("#modal-image").remove()},complete:function(){},success:function(e){_cl_cke.rangeCreate(),$("body").append('<div id="modal-image" class="modal">'+e+"</div>"),$("#modal-image").addClass("ck_image").css("z-index","15000").modal("show")}})})}}}),$(document).ajaxComplete(function(e,t,n){"object"==typeof cl_cke?"undefined"!=typeof CKEDITOR&&$("#modal-image.ck_image").length&&0<=String(n.url).indexOf("route=common/filemanager")&&$("#modal-image").off("click","a.thumbnail").on("click","a.thumbnail",function(e){return e.preventDefault(),_cl_cke.filename=$(this).attr("href"),_cl_cke.event_editor.config&&(_cl_cke.event_editor.config.forceRelativePath||_cl_cke.event_editor.config.forceDomainRemove)&&(e=new URL(_cl_cke.filename),_cl_cke.filename=e.pathname+""+e.search),CKEDITOR.tools.callFunction(_cl_cke.event_editor._.filebrowserFn,_cl_cke.filename),$("#modal-image").modal("hide"),$("#modal-image").remove(),!1}):console.error("cl_cke not found! Aborting...")}))},c_cke.prototype.checkUpdates=function(e,t){var n="";"undefined"!=typeof CKEDITOR&&(n=CKEDITOR.version);var i="",o=$('script[src*="ck_clicker.js"]:first').attr("src");void 0!==(o=String(o).split("?"))[1]&&o[1]&&(o=o[1],o=String(o).replace("oc=",""),o=String(o).replace("v=",""),void 0!==(o=String(o).split("&"))[0]&&(i=String(o[0])),void 0!==o[1]&&void 0!==(o=String(o[1]).split("_"))[0]&&(n=String(o[0])+"_CKE"+n));i={ex:"clicker_ckeditor",ve:n,oc:i=!i&&$("footer").length?$("footer").text():i,do:window.location.hostname,ws:1,or:"",li:"",wi:window.innerWidth,hi:window.innerHeight};$.ajax({url:"//clicker.com.ua/update.php",type:"post",dataType:"json",data:JSON.stringify(i),cache:!0,beforeSend:function(){$(".message-tooltip").remove(),$(".ck_clicker-updates-check").length||$(".cke").after('<div class="ck_clicker-updates-check"></div>'),$(".ck_clicker-updates-check").html()},complete:function(){},success:function(e){e.success,e.message&&$(".ck_clicker-updates-check").html(e.message),e.message_tooltip&&($(".message-tooltip").remove(),$(".ck_clicker-updates-check").before('<div class="alert alert-info alert-dismissible message-tooltip"><i class="fa fa-exclamation-circle"></i> '+e.message_tooltip+'<button type="button" class="close" data-dismiss="alert">&times;</button></div>'))},error:function(e,t,n){}})},c_cke.prototype.rangeCreate=function(){var e;window.getSelection()&&!window.getSelection().rangeCount&&$(".ImagePreviewBox *").length&&((e=document.createRange()).selectNodeContents($(".ImagePreviewBox *")[0]),window.getSelection().addRange(e))},c_cke.prototype.rangeClear=function(){window.getSelection()&&window.getSelection().rangeCount&&window.getSelection().removeAllRanges()},function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(window.jQuery)}(function(e){e.fn.extend({summernote:function(e){var n=this;return e&&"string"==typeof e?"code"==e?1<arguments.length&&void 0!==arguments[1]?this.code(arguments[1]):this.code():"destroy"==e?this.destroy():void 0:(n=replace_summernote(n,e),this.length&&(CKEDITOR.instances[this.attr("id")].on("blur",function(e){for(var t in n.val(this.getData()),CKEDITOR.instances)CKEDITOR.instances[t].updateElement()}),CKEDITOR.instances[this.attr("id")].on("change",function(e){n.val(this.getData())}),CKEDITOR.instances[this.attr("id")].on("beforeDestroy",function(e){for(var t in n.val(this.getData()),CKEDITOR.instances)CKEDITOR.instances[t].updateElement()})),n)},code:function(e){return"undefined"!=typeof CKEDITOR&&void 0!==CKEDITOR.instances[this.attr("id")]&&(e&&(CKEDITOR.instances[this.attr("id")]._.data=e),CKEDITOR.instances[this.attr("id")].updateElement(),this.val())},destroy:function(){return"undefined"!=typeof CKEDITOR&&void 0!==CKEDITOR.instances[this.attr("id")]&&CKEDITOR.instances[this.attr("id")].destroy(),this}})});